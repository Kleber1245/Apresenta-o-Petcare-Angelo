<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento - PetShop</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="Petcare.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Incluir a biblioteca jsPDF para geração de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* --------------------------------------------------------------------------
        ESTILOS ESPECÍFICOS PARA PAGAMENTO.HTML
        (AJUSTES APENAS PARA OS BOTÕES E NOVAS SEÇÕES DE CARTÃO, MANTENDO TODO O RESTO DO SEU CÓDIGO ORIGINAL)
        --------------------------------------------------------------------------
        */

        /* Seu estilo original para o body foi MANTIDO */
        body {
            background-image: url('gift(4).gif');
            background-size: cover;
            background-attachment: fixed;
            background-position: center center;
            background-repeat: no-repeat;
        }

        /* Seu estilo original para o container foi MANTIDO */
        .container {
            margin: 0 auto;
        }

        /* Os estilos da NAV foram REMOVIDOS daqui para serem gerenciados pelo Petcare.css.
           Você deve garantir que o Petcare.css contenha as regras de estilo para a nav
           (nav, nav ul, nav ul li a, nav ul li a:hover) que você deseja assimilar. */

        /* Seu estilo original para o header foi MANTIDO */
        header {
            padding: 50px 0;
            text-align: center;
            border-radius: 0;
            margin-bottom: 0;
            background-color: #fff;
        }

        /* Seu estilo original para o header .logo img foi MANTIDO */
        header .logo img {
            height: 80px;
            margin-bottom: 10px;
            border-radius: 0;
            box-shadow: none;
        }

        /* Seu estilo original para o header h1 foi MANTIDO */
        header h1 {
            font-size: 3em;
            color: #333;
            margin-bottom: 8px;
            letter-spacing: -0.02em;
            font-weight: 600;
        }

        /* Seu estilo original para o header .tagline foi MANTIDO */
        header .tagline {
            font-size: 1.2em;
            color: #666;
            font-weight: 300;
            margin-bottom: 0;
            max-width: none;
            margin-left: 0;
            margin-right: 0;
        }

        /* Seu estilo original para o main foi MANTIDO */
        main {
            padding-bottom: 60px;
            background-color: #fff;
            border-radius: 0;
            margin-bottom: 0;
            margin-top: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* Seu estilo original para o .payment-section foi MANTIDO */
        .payment-section {
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 700px;
            text-align: left;
        }

        /* Seu estilo original para o .payment-section h2 foi MANTIDO */
        .payment-section h2 {
            font-size: 2.5em;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            letter-spacing: -0.01em;
            font-weight: 600;
        }

        /* Seu estilo original para o .payment-methods foi MANTIDO */
        .payment-methods {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        /* --- ESTILOS DOS BOTÕES DE MÉTODO DE PAGAMENTO (ASSIMILANDO AO PETCARE.CSS) --- */
        .payment-method-btn {
            background-color: #f0f0f0; /* Fundo mais claro para inativo, para contraste */
            border: 1px solid #ddd; /* Borda suave */
            color: #555; /* Texto mais escuro */
            padding: 12px 25px; /* Padding aprimorado para toque */
            border-radius: 30px; /* Mais arredondado, como os botões do Petcare.html */
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease; /* Transição para todas as propriedades */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px; /* Espaço entre texto e imagem */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Sombra mais visível */
        }

        .payment-method-btn img {
            height: 22px; /* Tamanho um pouco maior para ícones */
            width: auto;
            filter: none;
        }

        .payment-method-btn:hover {
            background-color: #e5e5e5; /* Levemente mais escuro no hover */
            border-color: #bbb;
            transform: translateY(-2px); /* Efeito de "levantar" */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .payment-method-btn.active {
            background-color: #4CAF50; /* VERDE PETCARE para o botão ativo */
            color: #fff;
            border-color: #4CAF50;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .payment-method-btn.active img {
            filter: brightness(0) invert(1); /* Inverte a cor dos ícones para branco quando ativo */
        }

        /* Seu estilo original para o .payment-content foi MANTIDO */
        .payment-content {
            border-top: 1px solid #ddd;
            padding-top: 25px;
            margin-top: 25px;
        }

        /* Seu estilo original para o .payment-content h3 foi MANTIDO */
        .payment-content h3 {
            font-size: 1.4em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        /* Seu estilo original para o .form-group foi MANTIDO */
        .form-group {
            margin-bottom: 20px;
        }

        /* Seu estilo original para o .form-group label foi MANTIDO */
        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333;
            font-size: 1em;
        }

        /* Seu estilo original para o .form-group input, select foi MANTIDO */
        .form-group input,
        .form-group select {
            width: calc(100% - 20px);
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 0.95em;
            color: #555;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
        }

        /* Seu estilo original para o .form-group input/select:focus foi MANTIDO */
        .form-group input:focus,
        .form-group select:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.15);
            outline: none;
        }

        /* Seu estilo original para o .form-row foi MANTIDO */
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        /* Seu estilo original para o .form-row .form-group foi MANTIDO */
        .form-row .form-group {
            flex: 1;
        }

        /* --- ESTILO DO BOTÃO DE SUBMISSÃO (PAGAR AGORA) - ASSIMILANDO AO PETCARE.CSS --- */
        .btn-submit {
            background-color: #4CAF50; /* VERDE PETCARE */
            color: #fff;
            padding: 15px 30px; /* Padding maior para o botão principal */
            border: none;
            border-radius: 30px; /* Mais arredondado, como os botões do Petcare.html */
            font-size: 1.2em; /* Fonte maior */
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); /* Sombra mais pronunciada */
            text-transform: none;
            letter-spacing: 0;
            width: 100%;
            margin-top: 25px; /* Espaço maior acima */
        }

        .btn-submit:hover {
            background-color: #43a047; /* Verde um pouco mais escuro no hover */
            transform: translateY(-3px); /* Efeito de "levantar" */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Seu estilo original para #boleto-info, #pix-info foi MANTIDO */
        #boleto-info, #pix-info {
            text-align: center;
            padding: 15px;
            background-color: #f8f8f8;
            border-radius: 8px;
            margin-top: 15px;
        }

        /* Seu estilo original para #boleto-info p, #pix-info p foi MANTIDO */
        #boleto-info p, #pix-info p {
            margin-bottom: 10px;
            font-size: 1em;
            color: #555;
        }

        /* Seu estilo original para #boleto-codigo, #pix-qrcode-text foi MANTIDO */
        #boleto-codigo, #pix-qrcode-text {
            display: inline-block;
            background-color: #fff;
            border: 1px dashed #ccc;
            padding: 12px;
            border-radius: 5px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 1em;
            font-weight: 700;
            color: #333;
            word-break: break-all;
            user-select: all;
        }

        /* Seu estilo original para #pix-qrcode-img foi MANTIDO */
        #pix-qrcode-img {
            max-width: 180px;
            height: auto;
            display: block;
            margin: 15px auto 8px auto;
            border: 1px solid #eee;
            border-radius: 5px;
        }

        /* Seu estilo original para .copy-button foi MANTIDO */
        .copy-button {
            background-color: #2196F3;
            color: #fff;
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            font-size: 0.85em;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin-top: 10px;
        }

        /* Seu estilo original para .copy-button:hover foi MANTIDO */
        .copy-button:hover {
            background-color: #1976D2;
            transform: translateY(-1px);
        }

        /* Seu estilo original para o footer foi MANTIDO */
        footer {
            background-color: #444;
            color: #ccc;
            text-align: center;
            padding: 35px 0;
            font-size: 0.85em;
            border-top: 1px solid #666;
            margin-top: 0;
        }

        /* Seu estilo original para o footer p foi MANTIDO */
        footer p {
            margin-bottom: 15px;
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px;
        }

        /* Seu estilo original para o .social-links foi MANTIDO */
        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 0;
        }

        /* Seu estilo original para o .social-links a foi MANTIDO */
        .social-links a {
            display: inline-block;
            color: #333;
            opacity: 1;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease-in-out;
        }

        /* Seu estilo original para o .social-links a:hover foi MANTIDO */
        .social-links a:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Seu estilo original para o .social-links img foi MANTIDO */
        .social-links img {
            height: 35px;
            filter: none;
        }

        /* --- Responsividade: MANTIDO O SEU CÓDIGO ORIGINAL --- */
        @media (max-width: 1024px) {
            .container {
                max-width: 900px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 0 2%;
            }

            header {
                padding: 40px 0;
            }

            header h1 {
                font-size: 2.5em;
            }

            header .tagline {
                font-size: 1em;
            }

            main {
                padding: 40px 15px;
            }

            .payment-section {
                padding: 30px;
            }

            .payment-section h2 {
                font-size: 2.2em;
                margin-bottom: 25px;
            }

            .payment-methods {
                flex-direction: column;
                gap: 10px;
            }

            .payment-method-btn {
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .form-row .form-group {
                margin-bottom: 20px;
            }

            .form-group input, .form-group select {
                width: 100%;
                padding: 10px;
            }

            .btn-submit {
                padding: 12px 25px;
                font-size: 1.1em;
            }

            footer {
                padding: 30px 15px;
            }

            .social-links img {
                height: 35px;
            }

            /* Estilos de resumo do pedido em mobile */
            .order-summary-item {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .order-summary-item img {
                margin-bottom: 10px;
            }
            .order-summary-details {
                width: 100%;
            }
            .order-summary-price {
                margin-top: 10px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            header h1 {
                font-size: 2.2em;
            }

            .payment-section h2 {
                font-size: 1.8em;
            }

            .payment-section {
                padding: 20px;
            }
        }

        /* --- NOVOS ESTILOS PARA O RESUMO DO PEDIDO --- */
        .order-summary-container {
            border-top: 1px solid #ddd;
            padding-top: 25px;
            margin-top: 25px;
            text-align: left;
        }

        .order-summary-container h3 {
            font-size: 1.6em;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 600;
        }

        .order-summary-list {
            list-style: none;
            padding: 0;
            margin: 0;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .order-summary-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
            background-color: #fff;
        }

        .order-summary-item:last-child {
            border-bottom: none;
        }

        .order-summary-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 5px;
            margin-right: 15px;
            border: 1px solid #f0f0f0;
        }

        .order-summary-details {
            flex-grow: 1;
        }

        .order-summary-details h4 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            color: #333;
            font-weight: 600;
        }

        .order-summary-details p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }

        .order-summary-price {
            font-size: 1.1em;
            font-weight: 700;
            color: #4CAF50; /* Cor verde para o preço */
            text-align: right;
            white-space: nowrap; /* Evita quebra de linha no preço */
        }

        .order-summary-total {
            padding: 15px 20px;
            background-color: #f8f8f8;
            border-top: 1px solid #eee;
            text-align: right;
            font-size: 1.3em;
            font-weight: 700;
            color: #333;
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
        }

        .order-summary-total span {
            color: #4CAF50; /* Verde PetCare para o valor total */
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <ul>
                <li><a href="Produtos.html">Produtos</a></li>
                <li><a href="Serviços.html">Serviço</a></li>
                <li><a href="Agendamentos.html">Agendamento</a></li>
                <li><a href="Carrinho de Compras.html">Carrinho de Compras</a></li>
                <li><a href="Sugestões.html">Sugestões</a></li>
                <li><a href="Contatos.html">Contatos</a></li>
                <li><a href="Login.html">Login</a></li>
                <li><a href="Cadastro.html">Cadastrar Conta</a></li>
            </ul>
        </nav>

        <header>
            <div class="logo">
                <img src="Logo.jpg" alt="Logotipo PetShop">
                <h1>PetShop</h1>
                <p class="tagline">O melhor para o seu amigo de quatro patas</p>
            </div>
        </header>

        <main>
            <section class="payment-section">
                <h2>Finalizar Pagamento</h2>

                <div class="order-summary-container">
                    <h3>Resumo do seu Pedido</h3>
                    <ul id="order-products-list" class="order-summary-list">
                        <li id="empty-cart-message" style="text-align: center; padding: 20px; color: #777; display: none;">
                            Seu carrinho está vazio.
                        </li>
                    </ul>
                    <div id="order-summary-total" class="order-summary-total" style="display: none;">
                        Total do Pedido: <span id="summary-total-value">R$0,00</span>
                    </div>
                </div>
                <h3>Selecione o método de pagamento</h3>
                <div class="payment-methods">
                    <button type="button" class="payment-method-btn active" data-method="card-multiplo">
                        <i class="fas fa-credit-card"></i> Cartão Múltiplo
                    </button>
                    <button type="button" class="payment-method-btn" data-method="boleto">
                        <img src="Boleto Bancario.jpg" alt="Boleto">
                        Boleto Bancário
                    </button>
                    <button type="button" class="payment-method-btn" data-method="pix">
                        <img src="Pix.png" alt="Pix">
                        Pix
                    </button>
                </div>

                <form id="payment-form">
                    <h3>Informações de Contato</h3>
                    <div class="form-group">
                        <label for="nome-completo">Nome Completo</label>
                        <input type="text" id="nome-completo" name="nomeCompleto" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email">E-mail</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="telefone">Telefone</label>
                            <input type="tel" id="telefone" name="telefone" placeholder="(XX) XXXXX-XXXX" required>
                        </div>
                    </div>

                    <h3>Endereço de Entrega</h3>
                    <div class="form-group">
                        <label for="endereco">Endereço</label>
                        <input type="text" id="endereco" name="endereco" placeholder="Rua, Número, Complemento" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cidade">Cidade</label>
                            <input type="text" id="cidade" name="cidade" required>
                        </div>
                        <div class="form-group">
                            <label for="estado">Estado</label>
                            <input type="text" id="estado" name="estado" maxlength="2" placeholder="Ex: SP" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cep">CEP</label>
                            <input type="text" id="cep" name="cep" placeholder="XXXXX-XXX" required>
                        </div>
                    </div>

                    <div id="card-multiplo-fields" class="payment-content">
                        <h3>Detalhes do Pagamento (Cartão Múltiplo)</h3>
                        <div class="form-group">
                            <label for="tipo-cartao">Escolha o Tipo de Cartão</label>
                            <select id="tipo-cartao" name="tipoCartao">
                                <option value="credito">Crédito</option>
                                <option value="debito">Débito</option>
                            </select>
                        </div>

                        <div id="credit-card-details">
                            <div class="form-group">
                                <label for="numero-cartao-credito">Número do Cartão</label>
                                <input type="text" id="numero-cartao-credito" name="numeroCartaoCredito" placeholder="XXXX XXXX XXXX XXXX" maxlength="19">
                            </div>
                            <div class="form-group">
                                <label for="nome-cartao-credito">Nome no Cartão</label>
                                <input type="text" id="nome-cartao-credito" name="nomeCartaoCredito">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="validade-cartao-credito">Validade (MM/AA)</label>
                                    <input type="text" id="validade-cartao-credito" name="validadeCartaoCredito" placeholder="MM/AA" maxlength="5">
                                </div>
                                <div class="form-group">
                                    <label for="cvv-credito">CVV</label>
                                    <input type="text" id="cvv-credito" name="cvvCredito" placeholder="XXX" maxlength="4">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="parcelas">Número de Parcelas (até 10x sem juros)</label>
                                <select id="parcelas" name="parcelas">
                                    <option value="1">1x</option>
                                    <option value="2">2x</option>
                                    <option value="3">3x</option>
                                    <option value="4">4x</option>
                                    <option value="5">5x</option>
                                    <option value="6">6x</option>
                                    <option value="7">7x</option>
                                    <option value="8">8x</option>
                                    <option value="9">9x</option>
                                    <option value="10">10x</option>
                                </select>
                                <p id="valor-parcelas" style="margin-top: 10px; font-weight: bold; color: #4CAF50;"></p>
                            </div>
                        </div>

                        <div id="debit-card-details" style="display: none;">
                            <div class="form-group">
                                <label for="numero-cartao-debito">Número do Cartão de Débito</label>
                                <input type="text" id="numero-cartao-debito" name="numeroCartaoDebito" placeholder="XXXX XXXX XXXX XXXX" maxlength="19">
                            </div>
                            <div class="form-group">
                                <label for="nome-cartao-debito">Nome no Cartão</label>
                                <input type="text" id="nome-cartao-debito" name="nomeCartaoDebito">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="validade-cartao-debito">Validade (MM/AA)</label>
                                    <input type="text" id="validade-cartao-debito" name="validadeCartaoDebito" placeholder="MM/AA" maxlength="5">
                                </div>
                                <div class="form-group">
                                    <label for="cvv-debito">CVV</label>
                                    <input type="text" id="cvv-debito" name="cvvDebito" placeholder="XXX" maxlength="4">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="senha-online">Senha Online / PIN</label>
                                <input type="password" id="senha-online" name="senhaOnline" placeholder="Senha do cartão para compras online" maxlength="6">
                            </div>
                        </div>
                    </div>

                    <div id="boleto-info" class="payment-content" style="display: none;">
                        <h3>Detalhes do Pagamento (Boleto Bancário)</h3>
                        <p>O boleto será gerado após a confirmação do pedido.</p>
                        <p>Você poderá imprimi-lo ou copiar o código de barras para pagamento.</p>
                        <p>O prazo de vencimento do boleto é de **2 dias úteis** após a compra.</p> <!-- Texto atualizado -->
                        <p>A confirmação do pagamento pode levar até **2 dias úteis**.</p>
                    </div>

                    <div id="pix-info" class="payment-content" style="display: none;">
                        <h3>Detalhes do Pagamento (Pix)</h3>
                        <p>Pague com Pix de forma rápida e segura! Escaneie o QR Code ou copie e cole o código Pix no seu aplicativo de banco.</p>
                        <img id="pix-qrcode-img" src="https://www.cobrancaonline.com.br/wp-content/uploads/2021/04/qrcode-pix.png" alt="QR Code Pix - Exemplo">
                        <p>Ou copie o código:</p>
                        <span id="pix-qrcode-text">00020126360014BR.GOV.BCB.PIX011400000000000000005204000053039865802BR5922FULANO DE TAL DA SILVA6008BRASILIA62070503***6304E85C</span>
                        <button type="button" class="copy-button" onclick="copyPixCode()">Copiar Código Pix</button>
                        <p style="margin-top: 20px;">A confirmação do pagamento Pix é **instantânea**.</p>
                    </div>

                    <button type="submit" class="btn-submit">Pagar Agora</button>
                </form>
            </section>
        </main>

        <footer>
            <p>Seu amigo merece o melhor! Encontre tudo para ele em nosso PetShop. Oferecemos produtos de qualidade, atendimento especializado e um carinho que só quem ama pets entende.</p>
            <div class="social-links">
                <a href="#" target="_blank"><img src="https://logodownload.org/wp-content/uploads/2014/09/facebook-logo-5.png" alt="Facebook"></a>
                <a href="#" target="_blank"><img src="https://logodownload.org/wp-content/uploads/2014/09/Twitter-logo-1.png" alt="Twitter"></a>
                <a href="#" target="_blank"><img src="https://logodownload.org/wp-content/uploads/2017/04/instagram-logo.png" alt="Instagram"></a>
            </div>
            <p style="margin-top: 25px;">© 2025 PetShop. Todos os direitos reservados.</p>
        </footer>
    </div>

    <script>
        let currentPaymentMethod = 'card-multiplo'; // Método de pagamento inicial
        let currentCardType = 'credito'; // Tipo de cartão inicial

        // --- VALOR TOTAL DA COMPRA E PRODUTOS DO CARRINHO: RECUPERADOS DO SESSIONSTORAGE ---
        const valorTotalCompra = parseFloat(sessionStorage.getItem('valorTotalCompra')) || 0.00;
        const carrinhoProdutos = JSON.parse(sessionStorage.getItem('carrinhoProdutosParaPagamento')) || [];

        document.addEventListener('DOMContentLoaded', function() {
            const paymentMethodButtons = document.querySelectorAll('.payment-method-btn');
            const cardMultiploFields = document.getElementById('card-multiplo-fields');
            const creditCardDetails = document.getElementById('credit-card-details');
            const debitCardDetails = document.getElementById('debit-card-details');
            const boletoInfo = document.getElementById('boleto-info');
            const pixInfo = document.getElementById('pix-info');
            const paymentForm = document.getElementById('payment-form');
            const tipoCartaoSelect = document.getElementById('tipo-cartao');
            const parcelasSelect = document.getElementById('parcelas');
            const valorParcelasText = document.getElementById('valor-parcelas');

            // Elementos do resumo do pedido
            const orderProductsList = document.getElementById('order-products-list');
            const emptyCartMessage = document.getElementById('empty-cart-message');
            const orderSummaryTotalDiv = document.getElementById('order-summary-total');
            const summaryTotalValueSpan = document.getElementById('summary-total-value');

            // --- FUNÇÃO PARA RENDERIZAR O RESUMO DO PEDIDO ---
            function renderOrderSummary() {
                orderProductsList.innerHTML = ''; // Limpa a lista existente
                let totalResumo = 0;

                if (carrinhoProdutos.length === 0) {
                    emptyCartMessage.style.display = 'block';
                    orderSummaryTotalDiv.style.display = 'none';
                } else {
                    emptyCartMessage.style.display = 'none';
                    orderSummaryTotalDiv.style.display = 'block';

                    carrinhoProdutos.forEach(item => {
                        const li = document.createElement('li');
                        li.classList.add('order-summary-item');
                        const subtotal = item.preco * item.quantidade;
                        totalResumo += subtotal;

                        li.innerHTML = `
                            <img src="${item.imagem}" alt="${item.nome}">
                            <div class="order-summary-details">
                                <h4>${item.nome}</h4>
                                <p>Quantidade: ${item.quantidade}</p>
                            </div>
                            <span class="order-summary-price">R$${subtotal.toFixed(2).replace('.', ',')}</span>
                        `;
                        orderProductsList.appendChild(li);
                    });
                }
                summaryTotalValueSpan.textContent = `R$${totalResumo.toFixed(2).replace('.', ',')}`;
            }

            // Funções para gerenciar o estado dos campos 'required'
            function toggleRequired(container, isRequired) {
                const inputs = container.querySelectorAll('input, select');
                inputs.forEach(input => {
                    if (input.id !== 'parcelas' && input.id !== 'tipo-cartao') { // Exclui parcelas e tipo-cartao da validação de required
                        if (isRequired) {
                            input.setAttribute('required', 'true');
                        } else {
                            input.removeAttribute('required');
                        }
                    }
                });
            }

            // Função para alternar os campos de pagamento e tipo de cartão
            function showPaymentFields(method) {
                // Oculta todos os blocos de detalhes de pagamento
                cardMultiploFields.style.display = 'none';
                boletoInfo.style.display = 'none';
                pixInfo.style.display = 'none';

                // Remove 'required' de todos os campos de pagamento (será adicionado conforme o método ativo)
                toggleRequired(creditCardDetails, false);
                toggleRequired(debitCardDetails, false);

                if (method === 'card-multiplo') {
                    cardMultiploFields.style.display = 'block';
                    // Atualiza a exibição de acordo com o tipo de cartão selecionado
                    showCardTypeFields(tipoCartaoSelect.value);
                } else if (method === 'boleto') {
                    boletoInfo.style.display = 'block';
                } else if (method === 'pix') {
                    pixInfo.style.display = 'block';
                }
                currentPaymentMethod = method;
            }

            // Função para alternar entre campos de débito e crédito
            function showCardTypeFields(type) {
                if (type === 'credito') {
                    creditCardDetails.style.display = 'block';
                    debitCardDetails.style.display = 'none';
                    toggleRequired(creditCardDetails, true);
                    toggleRequired(debitCardDetails, false); // Garante que campos de débito não sejam obrigatórios
                    calculateParcelas(); // Calcula parcelas ao selecionar crédito
                } else { // débito
                    debitCardDetails.style.display = 'block';
                    creditCardDetails.style.display = 'none';
                    toggleRequired(debitCardDetails, true);
                    toggleRequired(creditCardDetails, false); // Garante que campos de crédito não sejam obrigatórios
                    valorParcelasText.textContent = ''; // Limpa texto de parcelas para débito
                }
                currentCardType = type;
            }

            // Função para calcular e exibir o valor das parcelas
            function calculateParcelas() {
                if (valorTotalCompra > 0) {
                    const numParcelas = parseInt(parcelasSelect.value);
                    const valorPorParcela = valorTotalCompra / numParcelas;
                    valorParcelasText.textContent = `${numParcelas}x de R$ ${valorPorParcela.toFixed(2).replace('.', ',')}`;
                } else {
                    valorParcelasText.textContent = 'Nenhum item no carrinho para parcelar.';
                }
            }

            // --- INICIALIZAÇÃO ---
            renderOrderSummary(); // Renderiza o resumo do pedido ao carregar a página
            showPaymentFields(currentPaymentMethod);
            showCardTypeFields(currentCardType);
            calculateParcelas(); // Garante que o valor das parcelas seja exibido corretamente no carregamento

            // Adiciona listeners aos botões de método de pagamento
            paymentMethodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    paymentMethodButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    showPaymentFields(this.dataset.method);
                });
            });

            // Listener para mudança no tipo de cartão (Débito/Crédito)
            tipoCartaoSelect.addEventListener('change', function() {
                showCardTypeFields(this.value);
            });

            // Listener para mudança no número de parcelas
            parcelasSelect.addEventListener('change', calculateParcelas);

            // Lidar com o envio do formulário
            paymentForm.addEventListener('submit', function(event) {
                event.preventDefault(); // Impede o envio padrão do formulário

                // Coletar dados de contato e endereço (sempre necessários)
                const contactAddressData = {
                    nomeCompleto: document.getElementById('nome-completo').value,
                    email: document.getElementById('email').value,
                    telefone: document.getElementById('telefone').value,
                    endereco: document.getElementById('endereco').value,
                    cidade: document.getElementById('cidade').value,
                    estado: document.getElementById('estado').value,
                    cep: document.getElementById('cep').value
                };

                let paymentData = {};
                let message = '';
                let isValid = true; // Variável para verificar se o formulário é válido

                // Validação básica dos campos de contato e endereço
                for (const key in contactAddressData) {
                    if (!contactAddressData[key]) {
                        alert(`Por favor, preencha o campo "${document.querySelector(`label[for="${key.replace(/[A-Z]/g, match => `-${match.toLowerCase()}`)}"]`).innerText}".`);
                        isValid = false;
                        break;
                    }
                }

                if (!isValid) return; // Se a validação básica falhar, para a execução

                if (currentPaymentMethod === 'boleto') {
                    // Dados para o boleto e nota fiscal
                    const nomeCompleto = document.getElementById('nome-completo').value;
                    const email = document.getElementById('email').value;
                    const telefone = document.getElementById('telefone').value;
                    const endereco = document.getElementById('endereco').value;
                    const cidade = document.getElementById('cidade').value;
                    const estado = document.getElementById('estado').value;
                    const cep = document.getElementById('cep').value;

                    // Obter a data atual
                    const today = new Date();
                    // Calcular a data de vencimento (hoje + 2 dias)
                    const dueDate = new Date();
                    dueDate.setDate(today.getDate() + 2);

                    const valorFormatado = valorTotalCompra.toFixed(2).replace('.', ',');
                    const dataVencimentoFormatada = dueDate.toLocaleDateString('pt-BR');
                    const dataEmissaoFormatada = today.toLocaleDateString('pt-BR');

                    // --- GERAÇÃO DA NOTA FISCAL (PDF 1) ---
                    const { jsPDF } = window.jspdf;
                    const docNotaFiscal = new jsPDF();

                    docNotaFiscal.setFontSize(22);
                    docNotaFiscal.text('Nota Fiscal - PetShop', 105, 30, { align: 'center' });

                    docNotaFiscal.setFontSize(12);
                    docNotaFiscal.text(`Data de Emissão: ${dataEmissaoFormatada}`, 20, 50);
                    docNotaFiscal.text(`Cliente: ${nomeCompleto}`, 20, 60);
                    docNotaFiscal.text(`E-mail: ${email}`, 20, 70);
                    docNotaFiscal.text(`Telefone: ${telefone}`, 20, 80);
                    docNotaFiscal.text(`Endereço: ${endereco}, ${cidade} - ${estado}, CEP: ${cep}`, 20, 90);

                    docNotaFiscal.setFontSize(16);
                    docNotaFiscal.text('Itens do Pedido:', 20, 110);
                    docNotaFiscal.setFontSize(12);

                    let yPos = 120;
                    carrinhoProdutos.forEach(item => {
                        const subtotalItem = (item.preco * item.quantidade).toFixed(2).replace('.', ',');
                        docNotaFiscal.text(`${item.nome} (x${item.quantidade}) - R$ ${subtotalItem}`, 25, yPos);
                        yPos += 10;
                    });

                    docNotaFiscal.setFontSize(16);
                    docNotaFiscal.text(`Total da Nota: R$ ${valorFormatado}`, 20, yPos + 10);
                    docNotaFiscal.save('nota_fiscal_petshop.pdf'); // Salva o primeiro PDF

                    // --- GERAÇÃO DO BOLETO CONVENCIONAL (PDF 2) ---
                    const docBoleto = new jsPDF();
                    let currentY = 20;

                    // Cabeçalho do Boleto (Banco e Linha Digitável)
                    docBoleto.setFontSize(10);
                    docBoleto.text('BANCO DO BRASIL', 20, currentY); // Exemplo de Banco
                    docBoleto.text('001-9', 60, currentY); // Código do Banco com dígito
                    docBoleto.setFontSize(14);
                    const barcodeNumber = '00190.00009 00000.000000 00000.000000 1 12345678901234'; // Linha Digitável Exemplo
                    docBoleto.text(barcodeNumber, 100, currentY);
                    currentY += 10;
                    docBoleto.line(10, currentY, 200, currentY); // Linha separadora

                    // Local de Pagamento e Vencimento
                    currentY += 5;
                    docBoleto.setFontSize(8);
                    docBoleto.text('LOCAL DE PAGAMENTO', 20, currentY);
                    docBoleto.text('VENCIMENTO', 150, currentY);
                    currentY += 5;
                    docBoleto.setFontSize(10);
                    docBoleto.text('PAGÁVEL EM QUALQUER BANCO ATÉ O VENCIMENTO', 20, currentY);
                    docBoleto.text(dataVencimentoFormatada, 150, currentY);
                    currentY += 5;
                    docBoleto.line(10, currentY, 200, currentY); // Linha separadora

                    // Beneficiário e Agência/Código Beneficiário
                    currentY += 5;
                    docBoleto.setFontSize(8);
                    docBoleto.text('BENEFICIÁRIO', 20, currentY);
                    docBoleto.text('AGÊNCIA / CÓDIGO DO BENEFICIÁRIO', 150, currentY);
                    currentY += 5;
                    docBoleto.setFontSize(10);
                    docBoleto.text('PETSHOP LTDA - CNPJ: XX.XXX.XXX/XXXX-XX', 20, currentY);
                    docBoleto.text('0000-0 / 123456-7', 150, currentY); // Exemplo de Agência/Código
                    currentY += 5;
                    docBoleto.line(10, currentY, 200, currentY); // Linha separadora

                    // Data do Documento, Número do Documento, Espécie Doc, Aceite, Data Processamento, Nosso Número
                    currentY += 5;
                    docBoleto.setFontSize(8);
                    docBoleto.text('DATA DO DOCUMENTO', 20, currentY);
                    docBoleto.text('NÚMERO DO DOCUMENTO', 60, currentY);
                    docBoleto.text('ESPÉCIE DOC.', 100, currentY);
                    docBoleto.text('ACEITE', 120, currentY);
                    docBoleto.text('DATA PROCESSAMENTO', 140, currentY);
                    docBoleto.text('NOSSO NÚMERO', 170, currentY);
                    currentY += 5;
                    docBoleto.setFontSize(10);
                    docBoleto.text(dataEmissaoFormatada, 20, currentY);
                    docBoleto.text('123456789', 60, currentY); // Exemplo
                    docBoleto.text('DM', 100, currentY);
                    docBoleto.text('N', 120, currentY);
                    docBoleto.text(dataEmissaoFormatada, 140, currentY);
                    docBoleto.text('001/1234567-8', 170, currentY); // Exemplo
                    currentY += 5;
                    docBoleto.line(10, currentY, 200, currentY); // Linha separadora

                    // Uso do Banco, Carteira, Espécie, Quantidade, Valor
                    currentY += 5;
                    docBoleto.setFontSize(8);
                    docBoleto.text('USO DO BANCO', 20, currentY);
                    docBoleto.text('CARTEIRA', 60, currentY);
                    docBoleto.text('ESPÉCIE', 100, currentY);
                    docBoleto.text('QUANTIDADE', 120, currentY);
                    docBoleto.text('VALOR', 170, currentY);
                    currentY += 5;
                    docBoleto.setFontSize(10);
                    docBoleto.text('', 20, currentY); // Campo vazio
                    docBoleto.text('109', 60, currentY); // Exemplo
                    docBoleto.text('R$', 100, currentY);
                    docBoleto.text('1', 120, currentY);
                    docBoleto.text(`R$ ${valorFormatado}`, 170, currentY);
                    currentY += 5;
                    docBoleto.line(10, currentY, 200, currentY); // Linha separadora

                    // Instruções
                    currentY += 5;
                    docBoleto.setFontSize(8);
                    docBoleto.text('INSTRUÇÕES', 20, currentY);
                    currentY += 5;
                    docBoleto.setFontSize(10);
                    docBoleto.text('PAGAR ATÉ O VENCIMENTO. APÓS, COBRAR MULTA DE 2% E JUROS DE 0,033% AO DIA.', 20, currentY);
                    currentY += 7;
                    docBoleto.text('NÃO RECEBER APÓS 30 DIAS DO VENCIMENTO.', 20, currentY);
                    currentY += 5;
                    docBoleto.line(10, currentY, 200, currentY); // Linha separadora

                    // Sacado (Pagador)
                    currentY += 5;
                    docBoleto.setFontSize(8);
                    docBoleto.text('SACADO', 20, currentY);
                    currentY += 5;
                    docBoleto.setFontSize(10);
                    docBoleto.text(`${nomeCompleto} - CPF/CNPJ: XXX.XXX.XXX-XX`, 20, currentY); // Exemplo CPF/CNPJ
                    currentY += 7;
                    docBoleto.text(`${endereco}, ${cidade} - ${estado}, CEP: ${cep}`, 20, currentY);
                    currentY += 5;
                    docBoleto.line(10, currentY, 200, currentY); // Linha separadora

                    // Linha Digitável Inferior
                    currentY += 5;
                    docBoleto.setFontSize(14);
                    docBoleto.text(barcodeNumber, 105, currentY, { align: 'center' });
                    currentY += 10;
                    docBoleto.line(10, currentY, 200, currentY); // Linha separadora

                    // Rodapé do Boleto
                    currentY += 5;
                    docBoleto.setFontSize(8);
                    docBoleto.text('AUTENTICAÇÃO MECÂNICA', 20, currentY);
                    docBoleto.text('FICHA DE COMPENSAÇÃO', 150, currentY);


                    docBoleto.save('boleto_petshop.pdf'); // Salva o segundo PDF

                    alert('Boleto e Nota Fiscal gerados com sucesso! Os downloads dos PDFs foram iniciados.');

                    // Limpar o carrinho e redirecionar
                    sessionStorage.removeItem('carrinho');
                    sessionStorage.removeItem('valorTotalCompra');
                    sessionStorage.removeItem('carrinhoProdutosParaPagamento');
                    window.location.href = 'Petcare.html'; // Redireciona para Petcare.html
                } else {
                    // Lógica existente para outros métodos de pagamento (Cartão e Pix)
                    if (currentPaymentMethod === 'card-multiplo') {
                        if (currentCardType === 'credito') {
                            paymentData = {
                                tipoCartao: 'credito',
                                numeroCartao: document.getElementById('numero-cartao-credito').value,
                                nomeCartao: document.getElementById('nome-cartao-credito').value,
                                validadeCartao: document.getElementById('validade-cartao-credito').value,
                                cvv: document.getElementById('cvv-credito').value,
                                parcelas: parcelasSelect.value
                            };
                            message = 'Pagamento com Cartão de Crédito processado com sucesso!';

                            // Validação específica para campos de cartão de crédito
                            if (!paymentData.numeroCartao || paymentData.numeroCartao.replace(/\s/g, '').length < 16) {
                                alert('Por favor, insira um número de cartão de crédito válido.');
                                isValid = false;
                            } else if (!paymentData.nomeCartao) {
                                alert('Por favor, insira o nome no cartão de crédito.');
                                isValid = false;
                            } else if (!paymentData.validadeCartao || !/^\d{2}\/\d{2}$/.test(paymentData.validadeCartao)) {
                                alert('Por favor, insira uma data de validade válida (MM/AA) para o cartão de crédito.');
                                isValid = false;
                            } else if (!paymentData.cvv || (paymentData.cvv.length !== 3 && paymentData.cvv.length !== 4)) {
                                alert('Por favor, insira um CVV válido (3 ou 4 dígitos) para o cartão de crédito.');
                                isValid = false;
                            }

                        } else { // Débito
                            paymentData = {
                                tipoCartao: 'debito',
                                numeroCartao: document.getElementById('numero-cartao-debito').value,
                                nomeCartao: document.getElementById('nome-cartao-debito').value,
                                validadeCartao: document.getElementById('validade-cartao-debito').value,
                                cvv: document.getElementById('cvv-debito').value,
                                senhaOnline: document.getElementById('senha-online').value
                            };
                            message = 'Pagamento com Cartão de Débito processado com sucesso!';

                            // Validação específica para campos de cartão de débito
                            if (!paymentData.numeroCartao || paymentData.numeroCartao.replace(/\s/g, '').length < 16) {
                                alert('Por favor, insira um número de cartão de débito válido.');
                                isValid = false;
                            } else if (!paymentData.nomeCartao) {
                                alert('Por favor, insira o nome no cartão de débito.');
                                isValid = false;
                            } else if (!paymentData.validadeCartao || !/^\d{2}\/\d{2}$/.test(paymentData.validadeCartao)) {
                                alert('Por favor, insira uma data de validade válida (MM/AA) para o cartão de débito.');
                                isValid = false;
                            } else if (!paymentData.cvv || (paymentData.cvv.length !== 3 && paymentData.cvv.length !== 4)) {
                                alert('Por favor, insira um CVV válido (3 ou 4 dígitos) para o cartão de débito.');
                                isValid = false;
                            } else if (!paymentData.senhaOnline) {
                                alert('Por favor, insira a senha online/PIN do cartão de débito.');
                                isValid = false;
                            }
                        }
                    } else if (currentPaymentMethod === 'pix') {
                        message = 'Pagamento Pix confirmado! Utilize o QR Code ou código para realizar a transferência.';
                    }

                    if (!isValid) return; // Se a validação específica do método falhar, para a execução

                    // Se o carrinho estiver vazio e o método de pagamento não for Pix ou Boleto (que podem ser informativos)
                    // Ou se você quiser que não seja possível pagar com valor 0 em cartão
                    if (valorTotalCompra <= 0 && (currentPaymentMethod === 'card-multiplo')) {
                        alert('Não é possível processar um pagamento com valor R$ 0,00 para este método.');
                        return;
                    }

                    console.log('Método de Pagamento:', currentPaymentMethod);
                    console.log('Dados de Contato e Endereço:', contactAddressData);
                    console.log('Dados de Pagamento:', paymentData);
                    console.log('Valor Total da Compra:', valorTotalCompra.toFixed(2));


                    alert(message + ' Redirecionando para a página de confirmação.');

                    // Limpar o carrinho (opcional, dependendo do fluxo)
                    sessionStorage.removeItem('carrinho');
                    sessionStorage.removeItem('valorTotalCompra'); // Limpa também o valor total
                    sessionStorage.removeItem('carrinhoProdutosParaPagamento'); // Limpa os produtos do carrinho

                    // Redirecionar para uma página de confirmação (pode ser a mesma para todos os métodos)
                    window.location.href = 'confirmacao_pagamento.html'; // Crie esta página!
                }
            });

            // Funções de máscara de input
            function applyCardNumberMask(elementId) {
                document.getElementById(elementId).addEventListener('input', function(e) {
                    e.target.value = e.target.value.replace(/\D/g, '').replace(/(\d{4})(?=\d)/g, '$1 ').trim();
                });
            }

            function applyValidityMask(elementId) {
                document.getElementById(elementId).addEventListener('input', function(e) {
                    e.target.value = e.target.value.replace(/\D/g, '').replace(/(\d{2})(?=\d)/, '$1/').slice(0, 5);
                });
            }

            applyCardNumberMask('numero-cartao-credito');
            applyValidityMask('validade-cartao-credito');
            applyCardNumberMask('numero-cartao-debito');
            applyValidityMask('validade-cartao-debito');

            document.getElementById('cep').addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '').replace(/^(\d{5})(\d)/, '$1-$2').slice(0, 9);
            });

            document.getElementById('telefone').addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, ''); // Remove todos os caracteres não numéricos
                let formattedValue = '';

                if (value.length > 0) {
                    formattedValue = `(${value.substring(0, 2)}`; // Adiciona o DDD entre parênteses
                    if (value.length > 2) {
                        // Se tiver 11 dígitos (celular), o formato é XXXXX-XXXX
                        // Se tiver 10 dígitos (fixo), o formato é XXXX-XXXX
                        if (value.length > 10) { // Para números com 11 dígitos (ex: 9XXXX-XXXX)
                            formattedValue += `) ${value.substring(2, 7)}`;
                            if (value.length > 7) {
                                formattedValue += `-${value.substring(7, 11)}`;
                            }
                        } else { // Para números com 10 dígitos (ex: XXXX-XXXX)
                            formattedValue += `) ${value.substring(2, 6)}`;
                            if (value.length > 6) {
                                formattedValue += `-${value.substring(6, 10)}`;
                            }
                        }
                    }
                }
                e.target.value = formattedValue;
            });
        });

        // Função para copiar o código Pix
        function copyPixCode() {
            const pixCodeElement = document.getElementById('pix-qrcode-text');
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(pixCodeElement.innerText)
                    .then(() => {
                        alert('Código Pix copiado para a área de transferência!');
                    })
                    .catch(err => {
                        console.error('Falha ao copiar o código Pix: ', err);
                        alert('Erro ao copiar o código Pix. Por favor, copie manualmente.');
                    });
            } else {
                const range = document.createRange();
                range.selectNodeContents(pixCodeElement);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                try {
                    document.execCommand('copy');
                    alert('Código Pix copiado para a área de transferência!');
                } catch (err) {
                    console.error('Falha ao copiar o código Pix: ', err);
                    alert('Erro ao copiar o código Pix. Por favor, copie manualmente.');
                }
                selection.removeAllRanges();
            }
        }
    </script>
</body>
</html>
